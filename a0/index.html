<!DOCTYPE html>
<html lang="">
    <head>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Testing</title>
        <style>
            body {
                background-color: #000;
                color: #888;
                font-family: Helvetica;
                line-height: 26px;
                margin: 0px;
                overflow: hidden;
            }
            h1 {
                color: #fff;
                margin: 8px;
            }
            a {
                color: #48f;
                text-decoration: none;
            }
            a:hover {
                color: #fff;
            }
            button {
                color: #000000;
                border: 0px;
                background-color: #48f;
                padding: 5px 15px;
                font-size: 18px;
                cursor: pointer;
            }
            button:hover {
                background-color: #fff;
            }
            #info {
                position: absolute;
                width: 360px;
                height: 90px;
                left: calc(50% - 180px);
                top: calc(50% - 150px);
                text-align: center;
            }
        </style>
    </head>

    <body>
        <script src="js/Frame.js"></script>
        <script src="js/libs/three.min.js"></script>
        <script src="js/modules/SceneModule1.js"></script>

        <script src="js/modules/WebGLRendererModule.js"></script>
        <script src="js/modules/ClearModule.js"></script>
        <script src="js/modules/FadeInModule.js"></script>

        <script src="js/shaders/CopyShader.js"></script>
        <script src="js/shaders/DigitalGlitch.js"></script>

        <script src="js/postprocessing/EffectComposer.js"></script>
        <script src="js/postprocessing/RenderPass.js"></script>
        <script src="js/postprocessing/MaskPass.js"></script>
        <script src="js/postprocessing/ShaderPass.js"></script>
        <script src="js/postprocessing/GlitchPass.js"></script>

        <script src="js/modules/SceneModule.js"></script>
        <script src="js/modules/SceneModule1.js"></script>
        <script src="js/modules/SceneModule2.js"></script>
        <script src="js/modules/TextModule.js"></script>
        <script src="js/modules/GlitchModule.js"></script>

        <script src="files/fonts/helvetiker_regular.typeface.js"></script>
        <script>
            var json =
                {
                    "metadata":{
                        "version":1
                    },
                    "timeline":[
                        [
                            0,
                            0,
                            355,
                            "WebGLRendererModule",
                            {
                                "width":1280,
                                "height":720,
                                "dom":null
                            }
                        ],
                        /*[
                            4,
                            0,
                            4.3125,
                            "FadeInModule",
                            {
                                "color":12312063,
                                "opacity":0.9
                            }
                        ],*/
                        [
                            1,
                            0,
                            355,
                            "ClearModule",
                            {

                            }
                        ],
                        /*[
                        3,
                        1.513,
                        18.151,
                        "TextModule",
                        {
                            "text":"Slow Intro",
                            "startPosition":[
                                0,
                                0,
                                18
                            ],
                            "endPosition":[
                                0,
                                0,
                                15
                            ]
                        }
                    ],*/
                        [
                            2,
                            1.513,
                            //0,
                            18.151,
                            "SceneModule1",
                            {
                                "startPosition":[
                                    100,
                                    125,
                                    200
                                ],
                                "endPosition":[
                                    -100,
                                    100,
                                    100
                                ]
                            }
                        ],
                        [
                            2,
                            19.664,
                            //0,
                            18.151,
                            "SceneModule2",
                            {
                                "startPosition":[
                                    500,
                                    500,
                                    500
                                ],
                                "endPosition":[
                                    500,
                                    525,
                                    600
                                ]
                            }
                        ],
                        /*[
                            3,
                            19.664,
                            18.151,
                            "TextModule",
                            {
                                "text":"Clean Enters",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],*/
                        [
                            3,
                            37.815,
                            16.261,
                            "TextModule",
                            {
                                "text":"Drums",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            54.076,
                            1.89,
                            "TextModule",
                            {
                                "text":"Riff Fade",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            55.966,
                            36.303,
                            "TextModule",
                            {
                                "text":"First Riff - 1",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            92.269,
                            36.302,
                            "TextModule",
                            {
                                "text":"First Riff - 2",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            128.571,
                            64.538,
                            "TextModule",
                            {
                                "text":"Second Riff",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            193.109,
                            16.135,
                            "TextModule",
                            {
                                "text":"Third - 1",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            209.244,
                            16.134,
                            "TextModule",
                            {
                                "text":"Third - 2",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            225.378,
                            16.135,
                            "TextModule",
                            {
                                "text":"Third - 1",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            241.513,
                            16.134,
                            "TextModule",
                            {
                                "text":"Third - 2",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            257.647,
                            16.135,
                            "TextModule",
                            {
                                "text":"Third - 1",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            273.782,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - One",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            281.849,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Two",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            289.916,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Three",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            297.983,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Fpur",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            306.05,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Five",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            314.117,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Six",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            322.184,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Seven",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            330.251,
                            8.067,
                            "TextModule",
                            {
                                "text":"Last - Eight",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                        [
                            3,
                            338.319,
                            13.11,
                            "TextModule",
                            {
                                "text":"Outro",
                                "startPosition":[
                                    0,
                                    0,
                                    18
                                ],
                                "endPosition":[
                                    0,
                                    0,
                                    15
                                ]
                            }
                        ],
                    ],
                        "curves":[

                    ]
                };
            /*var json =
                {
                    "metadata":{
                        "version":1
                    },
                    "timeline":[
                        [
                            0,
                            0,
                            355,
                            "WebGLRendererModule",
                            {
                                "width":1280,
                                "height":720,
                                "dom":null
                            }
                        ],
                        [
                            1,
                            0,
                            355,
                            "ClearModule",
                            {

                            }
                        ],
                        [
                            2,
                            1.513,
                            //0,
                            18.151,
                            "SceneModule1",
                            {
                                "startPosition":[
                                    100,
                                    100,
                                    200
                                ],
                                "endPosition":[
                                    -100,
                                    50,
                                    100
                                ]
                            }
                        ],
                    ],
                        "curves":[

                    ]
                };*/
            var timeline = new FRAME.Timeline();
            var modules = {};
            for ( var i = 0, l = json.timeline.length; i < l; i ++ ) {
                var data = json.timeline[ i ];
                var layer = data[ 0 ];
                var start = data[ 1 ];
                var duration = data[ 2 ];
                var moduleName = data[ 3 ];
                var parameters = data[ 4 ];
                if ( window[ moduleName ] === undefined ) {
                    console.log( 'FRAME: Missing module: ' + moduleName );
                    continue;
                }
                var module;
                if ( modules[ moduleName ] === undefined ) {
                    module = new window[ moduleName ];
                    module.name = moduleName;
                    modules[ moduleName ] = module;
                } else {
                    module = modules[ moduleName ];
                }
                for ( var key in parameters ) {
                    if ( module.parameters.input[ key ] === undefined ) {
                        console.log( 'FRAME: [' + moduleName + '] doesn\'t support "' + key + '" as input parameter' );
                        delete parameters[ key ];
                        continue;
                    }
                }
                if ( parameters.dom !== undefined ) {
                    parameters.dom = document.body;
                }
                var element = new FRAME.TimelineElement( moduleName, layer, start, duration, module, parameters );
                timeline.add( element );
            }
            var audio = document.createElement( 'audio' );
            audio.controls = true;
            audio.style.position = 'absolute';
            audio.style.left = 'calc(50% - 150px)';
            audio.style.bottom = '25px';
            audio.style.display = 'none';
            audio.style.transition = 'opacity 1s';
            document.body.appendChild( audio );
            var source = document.createElement( 'source' );
            source.src = 'files/obsidian.ogg';
            source.type = 'audio/ogg';
            audio.appendChild( source );
            var source = document.createElement( 'source' );
            source.src = 'files/a0.mp3';
            source.type = 'audio/mpeg';
            audio.appendChild( source );
            var timeoutID;
            var showControls = function ( event ) {
                audio.style.opacity = 0.5;
                if ( timeoutID !== undefined ) {
                    clearTimeout( timeoutID );
                }
                timeoutID = setTimeout( function () {
                    audio.style.opacity = 0;
                }, 1000 );
            };
            document.addEventListener( 'mousemove', showControls );
            document.addEventListener( 'touchstart', showControls );
            var animate = function () {
                if ( audio.duration > 0 && audio.currentTime === audio.duration ) {
                    audio.style.display = 'none';
                    var info = document.getElementById( 'info' );
                    info.style.display = '';
                    return;
                }
                requestAnimationFrame( animate );
                timeline.update( audio.currentTime );
            };
            var start = function () {
                audio.style.display = '';
                var info = document.getElementById( 'info' );
                info.style.display = 'none';
                audio.play();
                animate();
            };
            audio.style.display = '';
            //var info = document.getElementById( 'info' );
            //info.style.display = 'none';
            audio.addEventListener('canplaythrough', function(){
                //this.currentTime =19.664;
            })
            audio.volume = 0.5;
            audio.play();
            animate();
        </script>
        <!--<div id="info">
<h1>A0</h1>
<button onclick="javascript:start()">start</button>
</div>-->
    </body>
</html>
